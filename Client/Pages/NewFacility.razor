@using BlazorApp.Shared
@using BlazorApp.Client.Models
@inject HttpClient Http
@inject NavigationManager NavigationManager

@page "/newfacility"
@attribute [Authorize(Roles = "admin")]

<EditForm Model="@facility" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="form-group">
        <InputText class="form-control" placeholder="Название объекта" @bind-Value="facility.Name" />
    </div>
    <div class="form-group">
        <InputText class="form-control" placeholder="Адрес объекта" @bind-Value="facility.Address" />
    </div>
    <button type="submit" class="btn btn-primary">Создать</button>
</EditForm>

@code {
    private FacilityModel facility = new FacilityModel();

    private async Task HandleValidSubmit()
    {
        try
        {
            var dto = new FacilityDto
            {
                Name = facility.Name,
                Address = facility.Address
            };

            var result = await Http.PostAsJsonAsync<FacilityDto>("/api/NewFacility", dto);
            NavigationManager.NavigateTo("facility");
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.ToString());
        }
    }
}
